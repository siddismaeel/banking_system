<!DOCTYPE html>
<html lang="en">
<head>
  <title>Dashboard</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.js"></script>
  <link rel="stylesheet" href="my_style.css">
  <style>
    /* Set height of the grid so .sidenav can be 100% (adjust if needed) */
    .row.content {height: 1500px}
    
    /* Set gray background color and 100% height */
    .sidenav {
      background-color: #f1f1f1;
      height: 100%;
    }
    
    /* Set black background color, white text and some padding */
    footer {
      background-color: #555;
      color: white;
      padding: 15px;
    }
    
    /* On small screens, set height to 'auto' for sidenav and grid */
    @media screen and (max-width: 767px) {
      .sidenav {
        height: auto;
        padding: 15px;
      }
      .row.content {height: auto;} 
    }
  </style>
</head>
<body onload="loadData()">


<nav class="navbar navbar-inverse nav-bar">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>                        
      </button>
      <a class="navbar-brand" href="#">MY BANK</a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">
        <li class="active"><a href="#">Home</a></li>
        <li><a href="#">About</a></li>
        <li><a href="#">Contact</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="./logout"><span class="glyphicon glyphicon-log-in"></span> Logout</a></li>
      </ul>
    </div>
  </div>
</nav>  


<div class="container-fluid">
  <div class="row content">
    <div class="col-sm-3 sidenav">
      <!-- User information here  -->
      <table class="table" id="userTable">
		
			<tr>
				<th>Name:</th>
				<td id="name"></td>
				
			</tr>
			
			<tr>
				<th>User ID:</th>
				<td id="userId"></td>
				
			</tr>
			
			<tr>
				<th>Address:</th>
				<td id="address"> 
				</td>
			</tr>
			<tr>
				<th>Contact:</th>
				<td id="contact"></td>
			</tr>
			<tr>
				<th>Email:</th>
				<td id="email"></td>
				
			</tr>	
			
			<tr>
				<th>Account Number:</th>
				<td id="accountNumber"></td>
			</tr>
			<tr>
				<th>Account Type:</th>
				<td id="accountType"></td>
				
			</tr>	
			<tr>
				<th>Account Verified:</th>
				<td id="active"></td>
				
			</tr>
			<tr>
				<th>Account Balance:</th>
				<td id="balance"></td>
				
			</tr>
			
			
		
		</table>
    </div>

    <div class="col-sm-9">
				<div class="card" style="width: 28rem; display: inline-block; padding:10px;">
					
					<div class="card-body">
						<h2 class="card-title">Withdraw</h2>
						
						<span class="withdrawtMessage"></span>
						
						<table class="table" style="width:100%">


							<form method="post" action="./withdraw-amount" id="withdraw">
								<tr>
									<td>Amount:</td>
									<td><input type="number" name="amount" required></td>
								</tr>
								<tr>
									<td></td>
									<td><input type="submit" value="Withdraw" class="btn"></td>
								</tr>
							</form>
						</table>
					</div>
				</div>
				
				<div class="card" style="width: 28rem; display: inline-block; padding:10px;">
					
					<div class="card-body">
						<h2 class="card-title">Deposit Amount</h2>
						<span class="depositMessage"></span>
						<table class="table" style="width:100%">
							<form method="post" action="" id="deposit">

								<tr>
									<td>Amount:</td>
									<td><input type="number" name="amount" required></td>

								</tr>
								<tr>
									<td></td>
									<td><input type="submit" value="Deposit" class="btn"></td>

								</tr>

							</form>
						</table>
					</div>
				</div>
				
				<div class="card" style="width: 28rem; display: inline-block; padding:10px;">
					
					<div class="card-body">
						<h2 class="card-title">Reset Pin</h2>
						<span class="resetPinMessage"></span>

						<table class="table">
 							<form method="post" action="" id="resetPin">
								<tr>
									<td>Old Pin:</td>
									<td><input type="password" name="oldPin" required><br>
										<span></span> <span></span></td>
								</tr>

								<tr>
									<td>New Pin:</td>
									<td><input type="password" name="newPin" required><br>
										<span></span></td>
								</tr>

								<tr>
									<td>Re-enter Pin:</td>
									<td><input type="password" name="matchedPin" required><br>
										<span></span></td>
								</tr>
								<tr>
									<td></td>
									<td><input type="submit" value="Reset" class="btn"></td>
								</tr>
							</form>
						</table>

					</div>
				</div>
				
				<div class="card" style="width: 28rem; display: inline-block; padding:10px;">
					
					<div class="card-body">
						<h2 class="card-title">Reset User ID</h2>
						<span class="resetUserIdMessage"></span>

						<table class="table">

							<form method="post" action="" id="resetUserId">
								<tr>
									<td>New User Id:</td>
									<td><input type="text" name="userId" required></td>
								</tr>

								<tr>
									<td>Pin:</td>
									<td><input type="password" name="pin" required></td>
								</tr>
								<tr>
									<td></td>
									<td><input type="submit" value="Reset" class="btn"></td>
								</tr>
							</form>
						</table>

					</div>
				</div>
				
			</div>
  </div>
</div>

<footer class="container-fluid text-center" style="background-color: darkgray; color: white;">
  <p>Copyright 2021-22</p>
</footer>

<script>

/* $(document).on("submit", "#deposit", function() { 
    $.post("http://localhost:8080/banking_system/deposit-amount", function(responseText) {   
        $(".message").text(responseText);           
        console.log(responseText);
    });
}); */


/* $(document).ready(function() {
    $("#deposit").submit(function(event) {
      //event.preventDefault();
      $.ajax({
          type: 'POST',
          dataType: "json",
          url: 'http://localhost:8080/banking_system/deposit-amount',
          success: function(data) 
          {
              console.log(data);
             
          }
      });
    })
  })
 */
 
 $(document).ready(function(){
	    
	    $('#deposit').on('submit', function(event){
	        event.preventDefault();
	        
	        var f = $(this).serialize();
	        
	        $.ajax({
	            url: "http://localhost:8080/banking_system/deposit-amount",
	            data: f,
	            type: 'POST',
	            success: function (data, textState, jqXHR){
	                console.log("success....");
	                $('.depositMessage').text(data); 
	                loadData();
	                
	            },
	            error: function (jqXHR, textStatus, errorThrown){
	                
	                console.log('error...');
	            }
	        });
	        
	    });
	    
	}) 
	
	$(document).ready(function(){
	    
	    $('#withdraw').on('submit', function(event){
	        //event.preventDefault();
	        
	        var f = $(this).serialize();
	        
	        $.ajax({
	            url: "http://localhost:8080/banking_system/withdraw-amount",
	            data: f,
	            type: 'POST',
	            success: function (data, textState, jqXHR){
	                console.log("success....");
	                $('.withdrawtMessage').text(data); 
	                loadData();
	                
	            },
	            error: function (jqXHR, textStatus, errorThrown){
	                
	                console.log('error...');
	            }
	        });
	        
	    });
	    
	}) 
	
	$(document).ready(function(){
	    
	    $('#resetPin').on('submit', function(event){
	        event.preventDefault();
	        
	        var f = $(this).serialize();
	        
	        $.ajax({
	            url: "http://localhost:8080/banking_system/reset-pin",
	            data: f,
	            type: 'POST',
	            success: function (data, textState, jqXHR){
	                console.log("success....");
	                $('.resetPinMessage').text(data);  
	                
	            },
	            error: function (jqXHR, textStatus, errorThrown){
	                
	                console.log('error...');
	            }
	        });
	        
	    });
	    
	})
	
	$(document).ready(function(){
	    
	    $('#resetUserId').on('submit', function(event){
	        event.preventDefault();
	        
	        var f = $(this).serialize();
	        
	        $.ajax({
	            url: "http://localhost:8080/banking_system/reset-user-id",
	            data: f,
	            type: 'POST',
	            success: function (data, textState, jqXHR){
	                console.log("success....");
	                $('.resetUserIdMessage').text(data);  
	                loadData();
	                
	            },
	            error: function (jqXHR, textStatus, errorThrown){
	                
	                console.log('error...');
	            }
	        });
	        
	    });
	    
	})
	
	
	var xmlHttpRequest = new XMLHttpRequest();
	



function processRequest(){
	
	if(xmlHttpRequest.readyState == 4 && xmlHttpRequest.status == 200){
		var jsonStr = eval('(' + xmlHttpRequest.responseText +')');
		var table = document.getElementById("userTable");
		
		
		console.log("firstName " + jsonStr.firstName);
		$('#name').text(jsonStr.firstName + " " + jsonStr.lastName);
		$("#userId").text(jsonStr.account.userId);
		$('#address').text(jsonStr.street + " " + jsonStr.city + " " +jsonStr.state + " " + jsonStr.pin);
		$('#contact').text(jsonStr.contact);
		$('#email').text(jsonStr.email);
		$('#accountNumber').text(jsonStr.account.accountNumber);
		$('#accountType').text(jsonStr.account.accountType);
		$('#active').text(jsonStr.account.active);
		$('#balance').text(jsonStr.account.balance);
		
	}
	
}
	function loadData(){
	 
		 console.log('load data called');
		 
		 
		 xmlHttpRequest.open("Get", "http://localhost:8080/banking_system/getUser-details",true);
		 xmlHttpRequest.onreadystatechange = processRequest;
          
		 xmlHttpRequest.send(null);
      
	}
	 
	
 
	 
	 

</script>
</body>
</html>